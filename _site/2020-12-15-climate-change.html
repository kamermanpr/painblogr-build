<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" >

<!-- Head --------------------------------------------------------->

<head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta name="generator" content="pandoc"/>
	
	
	 <script src="site_libs/header-attrs-2.7/header-attrs.js"></script>
<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/yeti.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script> 

	
		<style type="text/css">
		code {
			white-space: pre;
		}
	</style>
	<style type="text/css">
		pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; } /* Alert */
code span.an { color: #008000; } /* Annotation */
code span.at { } /* Attribute */
code span.bu { } /* BuiltIn */
code span.cf { color: #0000ff; } /* ControlFlow */
code span.ch { color: #008080; } /* Char */
code span.cn { } /* Constant */
code span.co { color: #008000; } /* Comment */
code span.cv { color: #008000; } /* CommentVar */
code span.do { color: #008000; } /* Documentation */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.im { } /* Import */
code span.in { color: #008000; } /* Information */
code span.kw { color: #0000ff; } /* Keyword */
code span.op { } /* Operator */
code span.ot { color: #ff4000; } /* Other */
code span.pp { color: #ff4000; } /* Preprocessor */
code span.sc { color: #008080; } /* SpecialChar */
code span.ss { color: #008080; } /* SpecialString */
code span.st { color: #008080; } /* String */
code span.va { } /* Variable */
code span.vs { color: #008080; } /* VerbatimString */
code span.wa { color: #008000; font-weight: bold; } /* Warning */ 
	</style>

		<style type="text/css">
		pre:not([class]) {
			background-color: white;
		}
	</style>
	   	<style type="text/css">
		h1 {
			font-size: 34px;
		}

		h1.title {
			font-size: 38px;
		}

		h2 {
			font-size: 30px;
		}

		h3 {
			font-size: 24px;
		}

		h4 {
			font-size: 18px;
		}

		h5 {
			font-size: 16px;
		}

		h6 {
			font-size: 12px;
		}

		.table th:not([align]) {
			text-align: left;
		}

		
	</style>
	
		<link rel="stylesheet" href="css/custom.css" type="text/css" />  
    <!-- Latest maxdcn font-awesome and academicons -->
    <link rel="stylesheet" href="./css/font-awesome-4.5.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="./css/academicons-1.7.0/css/academicons.min.css">

    <!-- custom css -->
        <link rel="stylesheet" href="css/custom.css" type="text/css" />
	
    <!-- Include these sections here, otherwise YAML headings not inserted -->
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-71613331-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-71613331-1');
    </script>

    <!-- SEO -->
    <title>Using raster data to calculate and then map aridity indices</title>
    <meta name="description" content="Using raster maths to calculate global aridity and changes in aridity over time in parts of Southern Africa">
    <link rel="author" href="https://plus.google.com/u/0/103355314187199079295" />
    <meta name="robots" content="robots.txt">
    <link rel="canonical" href="https://www.painblogr.org/2020-12-15-climate-change.html">

    <!-- Twittercard -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@painblogR">
    <meta name="twitter:creator" content="@painblogR">
    <meta name="twitter:title" content="Using raster data to calculate and then map aridity indices">
    <meta name="twitter:description" content="Using raster maths to calculate global aridity and changes in aridity over time in parts of Southern Africa">
    <meta name="twitter:image" content="<a href="https://www.painblogr.org/images/posts/2020-12-15-climate-change/post-image.jpg" class="uri">https://www.painblogr.org/images/posts/2020-12-15-climate-change/post-image.jpg</a>">
    <meta name="twitter:url" content="https://www.painblogr.org/2020-12-15-climate-change.html">

    <!-- Opengraph -->
    <meta property="og:title" content="Using raster data to calculate and then map aridity indices">
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://www.painblogr.org/2020-12-15-climate-change.html">
    <meta property="og:image" content="<a href="https://www.painblogr.org/images/posts/2020-12-15-climate-change/post-image.jpg" class="uri">https://www.painblogr.org/images/posts/2020-12-15-climate-change/post-image.jpg</a>">
    <meta property="og:description" content="Using raster maths to calculate global aridity and changes in aridity over time in parts of Southern Africa">
    <meta property="og:site_name" content="painblogR">
    <meta property="fb:app_id" content="621412384962188">
</head>

<!-- Body --------------------------------------------------------->

<body>
    <!-- Navigation bar -->
    <nav class="navbar navbar-fixed-top" role="navigation" , style="background-color:#FFFFFF;border-bottom: 1px solid #CCCCCC;">
        <div class="container-fluid" id="navfluid">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar-collapse" aria-expanded="false">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <img src="images/capsaicin.png" alt="logo" , style="max-height:60px;padding-top:5px;">
                <span class="site-title"><a href="https://www.painblogr.org" style="color:#000000;font-size:250%;vertical-align:middle;">
				painblogR</a></span>&emsp;
            </div>

            <div class="collapse navbar-collapse" id="bs-navbar-collapse">
                <ul class="nav navbar-nav" style="display:table-row;padding-top:7px">
                    <li style="display:table-cell;float:none;vertical-align:middle;font-size:16px;"><a href="https://www.painblogr.org">Home</a></li>
                    <li style="display:table-cell;float:none;vertical-align:middle;font-size:16px;"><a href="./archive.html">Archive</a></li>
                    <li class="dropdown" style="display:table-cell;float:none;vertical-align:middle;font-size:16px;">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">About<span class="caret"></span></a>
                        <ul class="dropdown-menu">
                            <li><a href="./about_me.html">About me</a></li>
                            <li role="separator" class="divider"></li>
                            <li><a href="./publications.html">Publications & Reprints </a></li>
                        </ul>
                    </li>
                    <!---
                    # Teaching
                    <li class="dropdown" style="display:table-cell;float:none;vertical-align:middle;font-size:16px;">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Teaching<span class="caret"></span></a>
                        <ul class="dropdown-menu">
                            <li><a href="https://www.painblogr.org/biostatistics/">Introduction to Biostatistics</a></li>
                        </ul>
                    </li>
                    --->
                    <li class="dropdown" style="display:table-cell;float:none;vertical-align:middle;font-size:16px;">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Apps<span class="caret"></span></a>
                        <ul class="dropdown-menu">
                            <li><a href="https://kamermanpr.shinyapps.io/painblogr-statr/">statr: a stats calculator</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
            <!-- /. nav-collapse -->
        </div>
        <!-- /. container-fluid -->
    </nav>

	<!-- Extras -->
		<style type = "text/css">
		code {
  			color: inherit;
  			background-color: rgba(0, 0, 0, 0.04);
		}
		img {
  			max-width:100%;
  			height: auto;
		}
		.tabbed-pane {
  			padding-top: 12px;
		}
		button.code-folding-btn:focus {
  			outline: none;
		}
	</style>

	<div class="container-fluid main-container">
		<!-- tabsets -->
		<script src="/tabsets.js"></script>
		<script>
			$(document).ready(function () {
  			window.buildTabsets("TOC");
			});
		</script>

		<!-- code folding -->
		
		<div class="fluid-row" id="header">

    <!-- Main text --->
    <div class="container-fluid" id="mainbody">
         
        <h1>Using raster data to calculate and then map aridity indices</h1> 
        <h4>Peter Kamerman</h4> 
        <em>15 December 2020</em> <hr />
<p>I was asked by my wife, Prof Andrea Fuller, head of the <a href="https://www.wildlifeconservationphysiology.com/" target="_blank">Wildlife Conservation Physiology Lab</a>, University of the Witwatersrand, South Africa, to assist her and some colleagues who were writing a paper on how dryland mammals may respond to climate change <a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> to update a figure (see below) on the global aridity index, which appears in the 2019 IPCC report on climate change <a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a>. The original figure uses 2015 data, and they wanted to use 2019 data.</p>
<p>The aridity index is the ratio of the total amount of precipitation in an area and the amount of evapotranspiration . That is, what is the water gain (precipitation) relative to the amount of water loss (evapotranspiration) in a region. The smaller the ratio, the more arid a region is.</p>
<p>
<figure>
<img src="images/posts/2020-12-15-climate-change/ipcc-aridity-index-small.jpg"> <figurecaption><span style="font-weight:bold;">Figure: </span>Geographical distribution of drylands, delimited based on the aridity index</figurecaption>
</figure>
</p>
<p><br></p>
<p>I had used the mapping functions in <em>R</em> before (for example, <a href="https://www.painblogr.org/2019-03-09-pain-in-the-usa" target="_blank">see here</a>), but never to plot raster data. So, I took up the challenge to reproduce the plot.</p>
<p>This blog post details how I accomplished the task, and in the process provides me with a <em>“note to self”</em> on how I did it.</p>
<div id="global-drylands-figure" class="section level2">
<h2>Global drylands figure</h2>
<p>First I needed to get access to the raster data, which is freely available through the amazing TerraClimate project <a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a>. Although there are no aridity index rasters, data on precipitation and evapotranspiration are available for the period <a href="http://thredds.northwestknowledge.net:8080/thredds/catalog/TERRACLIMATE_ALL/data/catalog.html" target="_blank">1958 to 2019</a>, and from those data I could calculate the aridity index using raster maths.</p>
<div id="load-packages" class="section level3">
<h3>Load packages</h3>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load packages</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(raster) <span class="co"># Raster importing and manipulation</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2) <span class="co"># Plotting the raster image</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr) <span class="co"># General data processing</span></span></code></pre></div>
</div>
<div id="download-import-and-inspect-data" class="section level3">
<h3>Download, import, and inspect data</h3>
<p>For importing the data I used the <code>raster::stack</code> function, which imports the raster data stored in the _*.nc_ files I had downloaded. Each _*.nc_ file contained raster data for the 12 months of each year, and the <code>raster::stack</code> function imports the data and stacks them into a single ‘RasterStack’ object, with 12 layers (one for each month).</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#--- Download the files from the TerraClimate website ---#</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Precipitation</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">download.file</span>(<span class="at">url =</span> <span class="st">&#39;http://thredds.northwestknowledge.net:8080/thredds/fileServer/TERRACLIMATE_ALL/data/TerraClimate_ppt_2019.nc&#39;</span>,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">destfile =</span> <span class="st">&#39;ppt.nc&#39;</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Evapotranspiration</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="fu">download.file</span>(<span class="at">url =</span> <span class="st">&#39;http://thredds.northwestknowledge.net:8080/thredds/fileServer/TERRACLIMATE_ALL/data/TerraClimate_pet_2019.nc&#39;</span>,</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">destfile =</span> <span class="st">&#39;pet.nc&#39;</span>)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co">#--- Import the downloaded files ---#</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Precipitation</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>ppt <span class="ot">&lt;-</span> <span class="fu">stack</span>(<span class="at">x =</span> <span class="st">&#39;ppt.nc&#39;</span>)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Evapotranspiration</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>pet <span class="ot">&lt;-</span> <span class="fu">stack</span>(<span class="at">x =</span> <span class="st">&#39;pet.nc&#39;</span>)</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="co">#--- Inspect ---#</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Precipitation</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ppt)</span></code></pre></div>
<p><img src="2020-12-15-climate-change_files/figure-html/unnamed-chunk-3-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Evapotranspiration</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pet)</span></code></pre></div>
<p><img src="2020-12-15-climate-change_files/figure-html/unnamed-chunk-4-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>As can be seen from the plots, there are data for each month of 2019 (one for each layer in the ‘RasterStack’ object), but I want a single figure reflecting the average annual data. This is where raster maths came in handy.</p>
</div>
<div id="raster-maths" class="section level3">
<h3>Raster maths</h3>
<p>I used the <code>raster::calc</code> function to generate a new raster object consisting of a single layer by calculating the arithmetic mean across the layers of the RasterLayer object.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">#--- Raster maths ---#</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Precipitation</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>ppt_mean <span class="ot">&lt;-</span> <span class="fu">calc</span>(ppt, <span class="co"># RasterStack object</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">fun =</span> mean, <span class="co"># Function to apply across the layers</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Evapotranspiration</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>pet_mean <span class="ot">&lt;-</span> <span class="fu">calc</span>(pet,</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>                 <span class="at">fun =</span> mean, </span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>                 <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>You can also see that the small multiples shown above have Antarctica plotted, but the original figure does not, and so I needed to crop the rasters to exclude Antarctica using the <code>raster::extent</code> and <code>raster::crop</code> functions.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">#--- Set the extent ---#</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Cut off all values below 60 degrees South (removing Antarctica)</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>ext <span class="ot">&lt;-</span> <span class="fu">extent</span>(<span class="fu">c</span>(<span class="at">xmin =</span> <span class="sc">-</span><span class="dv">180</span>, <span class="at">xmax =</span> <span class="dv">180</span>, </span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">ymin =</span> <span class="sc">-</span><span class="dv">60</span>, <span class="at">ymax =</span> <span class="dv">90</span>))</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co">#--- Crop ---#</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Precipitation</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>ppt_mean <span class="ot">&lt;-</span> <span class="fu">crop</span>(<span class="at">x =</span> ppt_mean, </span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>                 <span class="at">y =</span> ext)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Evapotranspiration</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>pet_mean <span class="ot">&lt;-</span> <span class="fu">crop</span>(<span class="at">x =</span> pet_mean, </span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>                 <span class="at">y =</span> ext)</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="co">#--- Inspect ---#</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Precipitation</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">main =</span> <span class="st">&#39;Precipitation&#39;</span>,</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>     ppt_mean)</span></code></pre></div>
<p><img src="2020-12-15-climate-change_files/figure-html/unnamed-chunk-6-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Evapotranspiration</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">main =</span> <span class="st">&#39;Evapotranspiration&#39;</span>,</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>     pet_mean)</span></code></pre></div>
<p><img src="2020-12-15-climate-change_files/figure-html/unnamed-chunk-6-2.png" width="672" style="display: block; margin: auto;" /></p>
<p>Now that I had combined the layers into a single layer and cropped them to the area I wanted, I needed to calculate the aridity index by overlaying the two rasters <em>ppt_mean</em> and <em>pet_mean</em> and specifying how the layers should be combined using the <code>raster::overlay</code> function. In this case I wanted to take the ratio of precipitation to evapotranspiration.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">#--- Calculate aridity index ---#</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Precipitation (ppt) / Evapotranspiration (pet)</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>aridity_index <span class="ot">&lt;-</span> <span class="fu">overlay</span>(<span class="at">x =</span> ppt_mean, <span class="co"># Raster object 1</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">y =</span> pet_mean, <span class="co"># Raster object 2</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fun =</span> <span class="cf">function</span>(x, y){<span class="fu">return</span>(x <span class="sc">/</span> y)}) <span class="co"># Function to apply</span></span></code></pre></div>
<p>You can plot rasters using the <code>raster::plot</code> function, but I find it has limited functionality, so to give me more flexibility when plotting the aridity index, I converted the raster to a dataframe so that I could use <code>ggplot2</code>. First I converted the raster, using the <code>raster::rasterToPoints</code> function, to a matrix of x and y coordinates and a layer expressing the value at each coordinate.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">#--- Convert raster to a matrix ---#</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>aridity_index_matrix <span class="ot">&lt;-</span> <span class="fu">rasterToPoints</span>(aridity_index)</span></code></pre></div>
<p>Then I converted the matrix to a dataframe using the <code>base::as.data.frame</code> function, and recoded all the layer values into a categorical variable representing the aridity index (AI) categories. These categories are:</p>
<ul>
<li><p>Humid: AI <span class="math inline">\(\geq\)</span> 0.65,</p></li>
<li><p>Dry sub-humid: 0.50 <span class="math inline">\(&lt;\)</span> AI <span class="math inline">\(\leq\)</span> 0.65</p></li>
<li><p>Semi-arid: 0.20 <span class="math inline">\(&lt;\)</span> AI <span class="math inline">\(\leq\)</span> 0.50</p></li>
<li><p>Arid: 0.05 <span class="math inline">\(&lt;\)</span> AI <span class="math inline">\(\leq\)</span> 0.20</p></li>
<li><p>Hyper-arid: AI <span class="math inline">\(&lt;\)</span> 0.05</p></li>
</ul>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">#--- Convert to the matrix to a dataframe ---#</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>aridity_index_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(aridity_index_matrix)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co">#--- Recode aridity index into categories --#</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>aridity_index_df <span class="ot">&lt;-</span> aridity_index_df <span class="sc">%&gt;%</span> </span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Recode</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">category =</span> <span class="fu">case_when</span>(</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">is.infinite</span>(layer) <span class="sc">~</span> <span class="st">&#39;Humid&#39;</span>,</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    layer <span class="sc">&gt;=</span> <span class="fl">0.65</span> <span class="sc">~</span> <span class="st">&#39;Humid&#39;</span>,</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    layer <span class="sc">&gt;=</span> <span class="fl">0.5</span> <span class="sc">&amp;</span> layer <span class="sc">&lt;</span> <span class="fl">0.65</span> <span class="sc">~</span> <span class="st">&#39;Dry sub-humid&#39;</span>,</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    layer <span class="sc">&gt;=</span> <span class="fl">0.2</span> <span class="sc">&amp;</span> layer <span class="sc">&lt;</span> <span class="fl">0.5</span> <span class="sc">~</span> <span class="st">&#39;Semi-arid&#39;</span>,</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    layer <span class="sc">&gt;=</span> <span class="fl">0.05</span> <span class="sc">&amp;</span> layer <span class="sc">&lt;</span> <span class="fl">0.2</span> <span class="sc">~</span> <span class="st">&#39;Arid&#39;</span>,</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    layer <span class="sc">&lt;</span> <span class="fl">0.05</span> <span class="sc">~</span> <span class="st">&#39;Hyper-arid&#39;</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convert to ordered factor</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">category =</span> <span class="fu">factor</span>(category,</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>                           <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&#39;Hyper-arid&#39;</span>, <span class="st">&#39;Arid&#39;</span>, <span class="st">&#39;Semi-arid&#39;</span>,</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">&#39;Dry sub-humid&#39;</span>, <span class="st">&#39;Humid&#39;</span>),</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>                           <span class="at">ordered =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
</div>
<div id="plot-the-data" class="section level3">
<h3>Plot the data</h3>
<p>Lastly, I plotted the data.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">#--- Set a colour palette ---#</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>colours <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;#e31a1c&#39;</span>, <span class="st">&#39;#fd8d3c&#39;</span>, <span class="st">&#39;#fecc5c&#39;</span>, <span class="st">&#39;#ffffb2&#39;</span>, <span class="st">&#39;#666666&#39;</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co">#--- Plot the data ---#</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> aridity_index_df) <span class="sc">+</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">y =</span> y,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> x,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">fill =</span> category) <span class="sc">+</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_raster</span>() <span class="sc">+</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> colours,</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>                    <span class="at">guide =</span> <span class="fu">guide_legend</span>(<span class="at">reverse =</span> <span class="cn">TRUE</span>)) <span class="sc">+</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">60</span>, <span class="dv">90</span>),</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>                     <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">40</span>, <span class="sc">-</span><span class="dv">20</span>, <span class="dv">0</span>, <span class="dv">20</span>, <span class="dv">40</span>, <span class="dv">60</span>, <span class="dv">80</span>),</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="fu">expression</span>(<span class="st">&#39;40&#39;</span><span class="sc">*</span>degree<span class="sc">*</span><span class="st">&#39;S&#39;</span>),</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">expression</span>(<span class="st">&#39;20&#39;</span><span class="sc">*</span>degree<span class="sc">*</span><span class="st">&#39;S&#39;</span>),</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">expression</span>(<span class="st">&#39;0&#39;</span><span class="sc">*</span>degree),</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">expression</span>(<span class="st">&#39;20&#39;</span><span class="sc">*</span>degree<span class="sc">*</span><span class="st">&#39;N&#39;</span>),</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">expression</span>(<span class="st">&#39;40&#39;</span><span class="sc">*</span>degree<span class="sc">*</span><span class="st">&#39;N&#39;</span>),</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">expression</span>(<span class="st">&#39;60&#39;</span><span class="sc">*</span>degree<span class="sc">*</span><span class="st">&#39;N&#39;</span>),</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">expression</span>(<span class="st">&#39;80&#39;</span><span class="sc">*</span>degree<span class="sc">*</span><span class="st">&#39;N&#39;</span>))) <span class="sc">+</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">180</span>, <span class="dv">180</span>),</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>                     <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">180</span>, <span class="sc">-</span><span class="dv">120</span>, <span class="sc">-</span><span class="dv">60</span>, <span class="dv">0</span>, <span class="dv">60</span>, <span class="dv">120</span>, <span class="dv">180</span>),</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="fu">expression</span>(<span class="st">&#39;180&#39;</span><span class="sc">*</span>degree<span class="sc">*</span><span class="st">&#39;W&#39;</span>),</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">expression</span>(<span class="st">&#39;120&#39;</span><span class="sc">*</span>degree<span class="sc">*</span><span class="st">&#39;W&#39;</span>),</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">expression</span>(<span class="st">&#39;60&#39;</span><span class="sc">*</span>degree<span class="sc">*</span><span class="st">&#39;W&#39;</span>),</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">expression</span>(<span class="st">&#39;0&#39;</span><span class="sc">*</span>degree),</span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">expression</span>(<span class="st">&#39;60&#39;</span><span class="sc">*</span>degree<span class="sc">*</span><span class="st">&#39;E&#39;</span>),</span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">expression</span>(<span class="st">&#39;120&#39;</span><span class="sc">*</span>degree<span class="sc">*</span><span class="st">&#39;E&#39;</span>),</span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">expression</span>(<span class="st">&#39;180&#39;</span><span class="sc">*</span>degree<span class="sc">*</span><span class="st">&#39;E&#39;</span>))) <span class="sc">+</span></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span></span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">linetype =</span> <span class="dv">2</span>, </span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">size =</span> <span class="fl">0.5</span>,</span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">colour =</span> <span class="st">&#39;#666666&#39;</span>),</span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="2020-12-15-climate-change_files/figure-html/unnamed-chunk-10-1.png" width="864" style="display: block; margin: auto;" /></p>
<p>I think that is a fairly good reproduction of the original figure from the IPCC report, updated to use 2019 data. As you can see large swaths of North Africa, the Arabian Peninsula, and central Australia are deemed hyper-arid regions. In fact, most of Australia is hyper-arid or arid. The same goes for the Southern African region, which I am from, where the West coast is hyper-arid, and most of the rest of the region is arid or semi-arid.</p>
<p>Seeing this gradient from hyper-arid to semi-arid across the Southern African region, I wanted to see if there has been any changes in this gradient over the past 25 years.</p>
</div>
</div>
<div id="aridity-index-across-the-southern-parts-of-southern-africa-1995-to-2019" class="section level2">
<h2>Aridity index across the southern parts of Southern Africa (1995 to 2019)</h2>
<p>I wanted to use data from 1995 through to 2019, in 5-year periods. This meant downloading and processing multiple files, and to reduce the amount of repetition in my code, I turned to the various <code>map</code> functions in the <code>purrr</code> package.</p>
<div id="download-and-import-data" class="section level3">
<h3>Download and import data</h3>
<p>First I downloaded the data from TerraClimate project locally.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">#--- Load packages ---#</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co">#--- Precipitation ---#</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Construct a vector of URLs to download data</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="do">## Years to download</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>years <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">1995</span>, <span class="at">to =</span> <span class="dv">2015</span>, <span class="at">by =</span> <span class="dv">5</span>), <span class="dv">2019</span>)</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="do">## First chunk of the URL</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>precipitation_lead <span class="ot">&lt;-</span> <span class="st">&#39;http://thredds.northwestknowledge.net:8080/thredds/fileServer/TERRACLIMATE_ALL/data/TerraClimate_ppt_&#39;</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="do">## Piece together the precipitation_lead and year and add the file extension (.nc)</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>precipitation_urls <span class="ot">&lt;-</span> <span class="fu">paste0</span>(precipitation_lead, years, <span class="st">&#39;.nc&#39;</span>)</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Construct a vector of destination files</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>precipitation_destfile <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&#39;TerraClimate_ppt_&#39;</span>, years, <span class="st">&#39;.nc&#39;</span>)</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Download using the purrr::map2 functions</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a><span class="fu">map2</span>(<span class="at">.x =</span> precipitation_urls, <span class="co"># Input 1 to apply a function over</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>     <span class="at">.y =</span> precipitation_destfile, <span class="co"># Input 2 to apply a function over</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>     <span class="sc">~</span> <span class="fu">download.file</span>(<span class="at">url =</span> .x, <span class="co"># The function to apply</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>                     <span class="at">destfile =</span> .y,</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>                     <span class="at">method =</span> <span class="st">&#39;curl&#39;</span>))</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a><span class="co">#--- Evapotranspiration</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Construct a vector of URLs to download data</span></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a><span class="do">## First chunk of the URL</span></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>evapotranspiration_lead <span class="ot">&lt;-</span> <span class="st">&#39;http://thredds.northwestknowledge.net:8080/thredds/fileServer/TERRACLIMATE_ALL/data/TerraClimate_pet_&#39;</span></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a><span class="do">## Piece together the precipitation_lead and year and add the file extension (.nc)</span></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>evapotranspiration_urls <span class="ot">&lt;-</span> <span class="fu">paste0</span>(evapotranspiration_lead, years, <span class="st">&#39;.nc&#39;</span>)</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Construct a vector of destination files</span></span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>evapotranspiration_destfile <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&#39;TerraClimate_pet_&#39;</span>, years, <span class="st">&#39;.nc&#39;</span>)</span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Download using the purrr::map2 functions</span></span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a><span class="fu">map2</span>(<span class="at">.x =</span> evapotranspiration_urls,</span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>     <span class="at">.y =</span> evapotranspiration_destfile,</span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>     <span class="sc">~</span> <span class="fu">download.file</span>(<span class="at">url =</span> .x,</span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>                     <span class="at">destfile =</span> .y,</span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>                     <span class="at">method =</span> <span class="st">&#39;curl&#39;</span>))</span></code></pre></div>
<p>Then I imported the files. Again, I used the <code>raster::stack</code> function I had used for importing the data for the global map.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">#--- Precipitation ---#</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Get a list of precipitation file names</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>precipitation_files <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="at">path =</span> <span class="st">&#39;.&#39;</span>, <span class="at">pattern =</span> <span class="st">&#39;.ppt.&#39;</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Import using the purrr::map function to apply the raster::stack function</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>precipitation_rasters <span class="ot">&lt;-</span> <span class="fu">map</span>(<span class="at">.x =</span> precipitation_files,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>                             <span class="sc">~</span> <span class="fu">stack</span>(.x))</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="co">#--- Evapotranspiration ---#</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Get a list of evapotranspiration file names</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>evapotranspiration_files <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="at">path =</span> <span class="st">&#39;.&#39;</span>, <span class="at">pattern =</span> <span class="st">&#39;.pet.&#39;</span>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Import using the purrr::map function to apply the raster::stack function</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>evapotranspiration_rasters <span class="ot">&lt;-</span> <span class="fu">map</span>(<span class="at">.x =</span> evapotranspiration_files,</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>                                  <span class="sc">~</span><span class="fu">stack</span>(.x))</span></code></pre></div>
<p>Once I had imported the data, I needed to crop the large raster data to only include parts of Southern Africa, with a focus on South Africa.</p>
<p>By only using a subset of the data in the raster file, this cropping step would speed-up the processing of the data in later steps.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set extent to cover Southern Africa</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>ext2 <span class="ot">&lt;-</span> <span class="fu">extent</span>(<span class="dv">10</span>, <span class="dv">40</span>, <span class="sc">-</span><span class="dv">37</span>, <span class="sc">-</span><span class="dv">20</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Crop rasters</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Precipitation</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>precipitation_rasters <span class="ot">&lt;-</span> <span class="fu">map</span>(<span class="at">.x =</span> precipitation_rasters,</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>                             <span class="sc">~</span> <span class="fu">crop</span>(.x, ext2))</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="do">## Evapotranspiration</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>evapotranspiration_rasters <span class="ot">&lt;-</span> <span class="fu">map</span>(<span class="at">.x =</span> evapotranspiration_rasters,</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>                                  <span class="sc">~</span> <span class="fu">crop</span>(.x, ext2))</span></code></pre></div>
</div>
<div id="raster-maths-1" class="section level3">
<h3>Raster maths</h3>
<p>Then to calculate the annual mean for each year, I used the <code>raster::calc</code> function.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">#-- Calculate mean annual values --#</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Precipitation</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>precipitation_rasters <span class="ot">&lt;-</span> <span class="fu">map</span>(<span class="at">.x =</span> precipitation_rasters,</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>                             <span class="sc">~</span> <span class="fu">calc</span>(.x, </span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">fun =</span> mean, </span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Evapotranspiration</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>evapotranspiration_rasters <span class="ot">&lt;-</span> <span class="fu">map</span>(<span class="at">.x =</span> evapotranspiration_rasters,</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>                                  <span class="sc">~</span> <span class="fu">calc</span>(.x, </span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">fun =</span> mean, </span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
</div>
<div id="process-the-data-as-a-dataframe" class="section level3">
<h3>Process the data as a dataframe</h3>
<p>To try something different to the <code>raster::overlay</code> method I used in the previous section to calculate the global aridity index, in this section, I converted the raster objects to dataframes using the combination of <code>raster::rasterToPoints</code> and <code>base::as.data.frame</code>, and then did the maths using the <code>dplyr::mutate</code> function.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">#--- Convert each raster to a dataframe ---#</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Precipitation</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>precipitation_rasters <span class="ot">&lt;-</span> <span class="fu">map</span>(<span class="at">.x =</span> precipitation_rasters,</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>                             <span class="sc">~</span> <span class="fu">rasterToPoints</span>(.x) <span class="sc">%&gt;%</span> </span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">as.data.frame</span>(.) <span class="sc">%&gt;%</span> </span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">rename</span>(<span class="at">precipitation =</span> layer)) <span class="co"># For later join</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Evapotranspiration</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>evapotranspiration_rasters <span class="ot">&lt;-</span> <span class="fu">map</span>(<span class="at">.x =</span> evapotranspiration_rasters,</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>                             <span class="sc">~</span> <span class="fu">rasterToPoints</span>(.x) <span class="sc">%&gt;%</span> </span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">as.data.frame</span>(.) <span class="sc">%&gt;%</span> </span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">rename</span>(<span class="at">evapotranspiration =</span> layer)) <span class="co"># For later join</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="co">#--- Join the precipitation and evapotranspiration dataframes ---#</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>ai_df <span class="ot">&lt;-</span> <span class="fu">map2</span>(<span class="at">.x =</span> precipitation_rasters,</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>              <span class="at">.y =</span> evapotranspiration_rasters,</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>              <span class="sc">~</span> <span class="fu">left_join</span>(.x, .y))</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a><span class="co">#-- Add a year identifier to each dataframe --#</span></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>years2 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">1995</span>, <span class="at">to =</span> <span class="dv">2015</span>, <span class="at">by =</span> <span class="dv">5</span>), <span class="dv">2019</span>)</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>ai_df <span class="ot">&lt;-</span> <span class="fu">map2</span>(<span class="at">.x =</span> ai_df,</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>              <span class="at">.y =</span> years2,</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>              <span class="sc">~</span> .x <span class="sc">%&gt;%</span></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>                <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.character</span>(.y)))</span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a><span class="co">#-- Bind list items to make a single large dataframe (1995 to 2019) --#</span></span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>ai_df <span class="ot">&lt;-</span> <span class="fu">map_df</span>(<span class="at">.x =</span> ai_df,</span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>                <span class="sc">~</span> <span class="fu">bind_rows</span>(.x))</span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a><span class="co">#--- Calculate aridity index ---#</span></span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>ai_df <span class="ot">&lt;-</span> ai_df <span class="sc">%&gt;%</span> </span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">aridity_index =</span> precipitation <span class="sc">/</span> evapotranspiration)</span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a><span class="co">#--- Recode aridity index into categories --#</span></span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a>ai_df <span class="ot">&lt;-</span> ai_df <span class="sc">%&gt;%</span> </span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Recode</span></span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">category =</span> <span class="fu">case_when</span>(</span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">is.infinite</span>(aridity_index) <span class="sc">~</span> <span class="st">&#39;Humid&#39;</span>,</span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a>    aridity_index <span class="sc">&gt;=</span> <span class="fl">0.65</span> <span class="sc">~</span> <span class="st">&#39;Humid&#39;</span>,</span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a>    aridity_index <span class="sc">&gt;=</span> <span class="fl">0.5</span> <span class="sc">&amp;</span> aridity_index <span class="sc">&lt;</span> <span class="fl">0.65</span> <span class="sc">~</span> <span class="st">&#39;Dry sub-humid&#39;</span>,</span>
<span id="cb15-42"><a href="#cb15-42" aria-hidden="true" tabindex="-1"></a>    aridity_index <span class="sc">&gt;=</span> <span class="fl">0.2</span> <span class="sc">&amp;</span> aridity_index <span class="sc">&lt;</span> <span class="fl">0.5</span> <span class="sc">~</span> <span class="st">&#39;Semi-arid&#39;</span>,</span>
<span id="cb15-43"><a href="#cb15-43" aria-hidden="true" tabindex="-1"></a>    aridity_index <span class="sc">&gt;=</span> <span class="fl">0.05</span> <span class="sc">&amp;</span> aridity_index <span class="sc">&lt;</span> <span class="fl">0.2</span> <span class="sc">~</span> <span class="st">&#39;Arid&#39;</span>,</span>
<span id="cb15-44"><a href="#cb15-44" aria-hidden="true" tabindex="-1"></a>    aridity_index <span class="sc">&lt;</span> <span class="fl">0.05</span> <span class="sc">~</span> <span class="st">&#39;Hyper-arid&#39;</span></span>
<span id="cb15-45"><a href="#cb15-45" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb15-46"><a href="#cb15-46" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convert to ordered factor</span></span>
<span id="cb15-47"><a href="#cb15-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">category =</span> <span class="fu">factor</span>(category,</span>
<span id="cb15-48"><a href="#cb15-48" aria-hidden="true" tabindex="-1"></a>                           <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&#39;Hyper-arid&#39;</span>, <span class="st">&#39;Arid&#39;</span>, <span class="st">&#39;Semi-arid&#39;</span>,</span>
<span id="cb15-49"><a href="#cb15-49" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">&#39;Dry sub-humid&#39;</span>, <span class="st">&#39;Humid&#39;</span>),</span>
<span id="cb15-50"><a href="#cb15-50" aria-hidden="true" tabindex="-1"></a>                           <span class="at">ordered =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
</div>
<div id="get-natural-earth-map" class="section level3">
<h3>Get Natural Earth map</h3>
<p>I wanted to plot the country outlines on the raster image, and to do this I needed the <code>rnaturalearth</code> package, which makes it easy to global maps from the <a href="https://www.naturalearthdata.com/">Natural Earth</a> site.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load package</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rnaturalearth)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rnaturalearthdata)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="co">#--- Get medium scale (1:50) map of Southern African countries ---#</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Get a map of Africa</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>africa <span class="ot">&lt;-</span> <span class="fu">ne_countries</span>(<span class="at">scale =</span> <span class="dv">50</span>, </span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>                       <span class="at">continent =</span> <span class="st">&#39;Africa&#39;</span>)</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract Southern African countries</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>country_filter <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;ZAF&#39;</span>, <span class="st">&#39;NAM&#39;</span>, <span class="st">&#39;BWA&#39;</span>, <span class="st">&#39;ZWE&#39;</span>, <span class="st">&#39;MOZ&#39;</span>, <span class="st">&#39;MWI&#39;</span>, <span class="st">&#39;ZMB&#39;</span>, <span class="st">&#39;AGO&#39;</span>)</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>s_africa <span class="ot">&lt;-</span> africa <span class="sc">%&gt;%</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(.) <span class="sc">%&gt;%</span> <span class="co"># Convert the large SpatialPolygonDataFrame into a sf object</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(sov_a3 <span class="sc">%in%</span> country_filter) <span class="co"># Filter out the countries I want</span></span></code></pre></div>
</div>
<div id="plot-the-data-1" class="section level3">
<h3>Plot the data</h3>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co">#--- Plot the data ---#</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_raster</span>(<span class="at">data =</span> ai_df, <span class="co"># Plot the aridity index raster</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">x =</span> x,</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">y =</span> y,</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">fill =</span> category)) <span class="sc">+</span> </span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> s_africa,</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>          <span class="at">alpha =</span> <span class="dv">0</span>) <span class="sc">+</span> <span class="co"># Plot Southern Africa</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> colours, <span class="co"># Already set for the global aridity index map</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>                    <span class="at">guide =</span> <span class="fu">guide_legend</span>(<span class="at">reverse =</span> <span class="cn">TRUE</span>)) <span class="sc">+</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">37</span>, <span class="sc">-</span><span class="dv">21</span>),</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">40</span>)) <span class="sc">+</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>(<span class="at">base_size =</span> <span class="dv">18</span>) <span class="sc">+</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>year, <span class="at">ncol =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.title =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="2020-12-15-climate-change_files/figure-html/unnamed-chunk-16-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>It’s always difficult to interpret a series of snapshots in time, and as can be seen in the figure, there are spatial fluctuations in the aridity index across the ~25 years. For example, the humid zone increases massively in 2000, but is minimal in most other years. Indeed, it appears that there is a gradual encroachment of the semi-arid regions into the dry semi-humid and humid zones on the east coast. What is clear, is that 2019 was a bad year, with large expanses of Namibia and South Africa experiencing hyper-arid conditions. It will be interesting to see if this trend continues in 2020, especially since the <em>El Nino-Southern Oscillation</em> is in a <em>La Nina</em> state in 2020, which is associated with above average rainfall in Southern Africa.</p>
<p>Another approach to analysing the data could be to average the aridity index values over multiple years, thus exposing smoothed temporal trends. I hope you found this blog post useful, and that you enjoyed reading it.</p>
<hr />
</div>
</div>
<div id="session-information" class="section level1">
<h1>Session information</h1>
<pre><code>## R version 4.0.4 (2021-02-15)
## Platform: x86_64-apple-darwin17.0 (64-bit)
## Running under: macOS Catalina 10.15.7
## 
## Matrix products: default
## BLAS:   /Library/Frameworks/R.framework/Versions/4.0/Resources/lib/libRblas.dylib
## LAPACK: /Library/Frameworks/R.framework/Versions/4.0/Resources/lib/libRlapack.dylib
## 
## Random number generation:
##  RNG:     Mersenne-Twister 
##  Normal:  Inversion 
##  Sample:  Rounding 
##  
## locale:
## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
## 
## attached base packages:
## [1] grid      stats     graphics  grDevices utils     datasets  methods  
## [8] base     
## 
## other attached packages:
##  [1] rnaturalearthdata_0.1.0 rnaturalearth_0.1.0     raster_3.4-5           
##  [4] lspline_1.0-0           carrots_0.1.0           geofacet_0.2.0         
##  [7] survey_4.0              survival_3.2-9          Matrix_1.3-2           
## [10] sf_0.9-7                fiftystater_1.0.1       skimr_2.1.3            
## [13] magrittr_2.0.1          geojsonio_0.9.4         lubridate_1.7.10       
## [16] xml2_1.3.2              sp_1.4-5                leaflet_2.0.4.1        
## [19] highcharter_0.8.2       flexdashboard_0.5.2     gganimate_1.0.7        
## [22] gdtools_0.2.3           ggiraph_0.7.8           svglite_2.0.0          
## [25] pander_0.6.3            knitr_1.31              forcats_0.5.1          
## [28] stringr_1.4.0           dplyr_1.0.5             purrr_0.3.4            
## [31] readr_1.4.0             tidyr_1.1.3             tibble_3.1.0           
## [34] ggplot2_3.3.3           tidyverse_1.3.0        
## 
## loaded via a namespace (and not attached):
##   [1] colorspace_2.0-0   ellipsis_0.3.1     class_7.3-18      
##   [4] rgdal_1.5-23       base64enc_0.1-3    fs_1.5.0          
##   [7] rstudioapi_0.13    httpcode_0.3.0     farver_2.1.0      
##  [10] ggrepel_0.9.1      fansi_0.4.2        codetools_0.2-18  
##  [13] splines_4.0.4      ncdf4_1.17         rlist_0.4.6.1     
##  [16] jsonlite_1.7.2     broom_0.7.5        dbplyr_2.1.0      
##  [19] png_0.1-7          rgeos_0.5-5        compiler_4.0.4    
##  [22] httr_1.4.2         backports_1.2.1    assertthat_0.2.1  
##  [25] lazyeval_0.2.2     cli_2.3.1          tweenr_1.0.1      
##  [28] htmltools_0.5.1.1  prettyunits_1.1.1  tools_4.0.4       
##  [31] igraph_1.2.6       gtable_0.3.0       glue_1.4.2        
##  [34] geojson_0.3.4      V8_3.4.0           Rcpp_1.0.6        
##  [37] imguR_1.0.3        cellranger_1.1.0   jquerylib_0.1.3   
##  [40] vctrs_0.3.6        crul_1.1.0         nlme_3.1-152      
##  [43] crosstalk_1.1.1    xfun_0.22          rvest_1.0.0       
##  [46] lifecycle_1.0.0    jqr_1.2.0          zoo_1.8-9         
##  [49] scales_1.1.1       hms_1.0.0          yaml_2.2.1        
##  [52] quantmod_0.4.18    curl_4.3           gridExtra_2.3     
##  [55] sass_0.3.1         stringi_1.5.3      highr_0.8         
##  [58] maptools_1.0-2     e1071_1.7-4        TTR_0.24.2        
##  [61] boot_1.3-27        repr_1.1.3         rlang_0.4.10      
##  [64] pkgconfig_2.0.3    systemfonts_1.0.1  geogrid_0.1.1     
##  [67] evaluate_0.14      lattice_0.20-41    htmlwidgets_1.5.3 
##  [70] labeling_0.4.2     tidyselect_1.1.0   geojsonsf_2.0.1   
##  [73] R6_2.5.0           magick_2.7.0       generics_0.1.0    
##  [76] DBI_1.1.1          mgcv_1.8-34        pillar_1.5.1      
##  [79] haven_2.3.1        foreign_0.8-81     withr_2.4.1       
##  [82] units_0.7-0        xts_0.12.1         modelr_0.1.8      
##  [85] crayon_1.4.1       uuid_0.1-4         KernSmooth_2.23-18
##  [88] utf8_1.2.1         rmarkdown_2.7      jpeg_0.1-8.1      
##  [91] progress_1.2.2     readxl_1.3.1       data.table_1.14.0 
##  [94] reprex_1.0.0       digest_0.6.27      classInt_0.4-3    
##  [97] webshot_0.5.2      munsell_0.5.0      viridisLite_0.3.0 
## [100] kableExtra_1.3.4   bslib_0.2.4        mitools_2.4</code></pre>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>Fuller A, et al., How dryland mammals will respond to climate change: the effects of body size, heat load, and a lack of food and water. <em>J Exp Biol</em> <strong>IN PRESS</strong>. DOI: <a href="https://doi.org/10.1242/jeb.2381138">10.1242/jeb.238113</a><a href="#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>Desertification. <em>In:</em> Climate Change and Land: an IPCC special report on climate change, desertification, land degradation, sustainable land management, food security, and greenhouse gas fluxes in terrestrial ecosystems. URL: <a href="https://www.ipcc.ch/srccl/chapter/chapter-3/" target="_blank">ipcc.ch/srccl/chapter/chapter-3/</a>. Accessed: 15 December 2019.<a href="#fnref2" class="footnote-back">↩︎</a></p></li>
<li id="fn3"><p>Abatzoglou JT, Dobrowski SZ, Parks SA, Hegewisch KC. TerraClimate, a high-resolution global dataset of monthly climate and climatic water balance from 1958-2015. <em>Sci Data</em> <strong>5</strong>:170191, 2018. DOI: <a href="https://doi.org/10.1038/sdata.2017.191">10.1038/sdata.2017.191</a><a href="#fnref3" class="footnote-back">↩︎</a></p></li>
</ol>
</div>

        <!-- Include these sections here, otherwise YAML headings not inserted -->
        <!-- Share -->
        <div class="share">
            <p style="display:inline-block">
                <hr>
                <h3>Share</h3>&ensp;
                <a href="mailto:?subject=Using raster data to calculate and then map aridity indices&body=Hi, I thought you might like this post I found on painblogR:%0D%0A%0D%0Ahttps://www.painblogr.org/2020-12-15-climate-change.html.%0D%0A%0D%0ABest regards" target="_blank"><i class="fa fa-envelope" style="color:#000000;vertical-align:middle;" title="Share on email" ></i></a>&ensp;
                <a href="https://twitter.com/intent/tweet?url=https://www.painblogr.org/2020-12-15-climate-change.html&text=Using raster data to calculate and then map aridity indices&via=painblogR" rel="nofollow" target="_blank" title="Share on Twitter"><i class="fa fa-twitter" style="color:#000000;vertical-align:middle;"></i></a>&ensp;
                <a href="https://facebook.com/sharer.php?u=https://www.painblogr.org/2020-12-15-climate-change.html" rel="nofollow" target="_blank" title="Share on Facebook"><i class="fa fa-facebook" style="color:#000000;vertical-align:middle;"></i></a>&ensp;
                <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://www.painblogr.org/2020-12-15-climate-change.html" rel="nofollow" target="_blank" title="Share on LinkedIn"><i class="fa fa-linkedin" style="color:#000000;vertical-align:middle;"></i></a>
            </p>
        </div>

        <!-- Disqus
        <div class="comments">
            <hr>
            <h3>Comments</h3>
            <div id="disqus_thread"></div>
            <script>
                var disqus_config = function() {
                    this.page.url = 'https://www.painblogr.org/2020-12-15-climate-change.html'
                    this.page.identifier = '/2020-12-15-climate-change.html'
                };

                (function() {
                    var d = document,
                        s = d.createElement('script');

                    s.src = 'https://www.painblogr.disqus.com/embed.js';
                    s.setAttribute('data-timestamp', +new Date());
                    (d.head || d.body).appendChild(s);
                })();
            </script>
            <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
            </noscript>
        </div>
    </div> -->

    <!-- Footer -->
    <footer>
         <!--footer-->
<div class="container-fluid" id="foot" style="background-color:#FFFFFF;border-top:#CCCCCC solid 1px;color:#999999;font-family:'Open sans', 'Helvetica';">
    <div class="row">
        <div class="col-sm-4">
            <p>Hosted by: <a href="https://www.netlify.com" target="_blank">netlify.com</a>
                <br>Powered by: <a href="http://rmarkdown.rstudio.com/" target="_blank">RMarkdown</a>
                <br>
                <br>
            </p>
        </div>
        <div class="col-sm-4">
            <p>Fork/clone from: <a href="https://github.com/kamermanpr/painblogr-build.git" target="_blank">GitHub</a>
                <br>License: <a href="./LICENSE.html" target="_blank">MIT & CC-BY 4.0</a>
                <br>
                <br>
            </p>
        </div>
        <div class="col-sm-4">
            <h4 style="padding:0;margin:0">painblogR</h3>
			   <p style="display:inline-block">
				   <span style="font-style:italic">by Peter Kamerman</span>
				   &ensp;
				   <a href="mailto:peter.kamerman@gmail.com" title="Email me" target="_blank"><i style="color:#999999;" class="fa fa-envelope"></i></a>
				   &ensp;
				   <a href="//twitter.com/@painblogR" target="_blank" title="Follow me"><i style="color:#999999;" class="fa fa-twitter"></i></a>
			   </p>
		   </div>
	   </div>
	</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});

</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script> 
    </footer>
</body>
</html>
